---
title: "Sistemas de Información Geográfica con R"
subtitle: "Mapas interactivos con Leaflet"
author: "Edimer David Jaramillo"
output:
  html_notebook:
    toc: true
    toc_float:
      smooth_scroll: true
      collapsed: false
    code_folding: hide
    highlight: breezedark
---

```{r}
knitr::opts_chunk$set(fig.align = "center",
                      warning = FALSE,
                      message = FALSE,
                      fig.width = 9)
```


- Notas tomadas del curso ["Sistemas de Información Geográfica en R (SIG en R)" con Derek Corcoran.](https://www.youtube.com/watch?v=yKUM45-LuHk&ab_channel=DerekCorcoran)

<iframe width="560" height="315" src="https://www.youtube.com/embed/yKUM45-LuHk" frameborder="0" allowfullscreen></iframe>

# Bibliotecas

```{r}
library(leaflet)
library(leaflet.extras) 
library(rworldxtra)
library(tidyverse)
library(sf)
library(raster)
```

# Datos

<center>
<img src = "https://mir-s3-cdn-cf.behance.net/projects/404/f4079686720035.Y3JvcCw5NzAsNzU5LDExNSwyMjE.png" />
</center>

- Para este documento voy a trabajar con el oso de anteojos (*Tremarcto ornatus*). La base de datos con el registro de presencias es obtenida del [gbif](https://www.gbif.org/) usando la biblioteca **rgbif** de R.

## Datos gbif

```{r}
library(rgbif)
library(Hmisc)
gbif_to <- occ_search(scientificName = "Tremarctos ornatus",
                  limit = 5000, return = "data",
                  hasCoordinate = TRUE)

data_to <- gbif_to$data
data_to %>% 
  filter(country == "Colombia") %>% 
  filter(!duplicated(decimalLatitude, decimalLongitude)) %>% 
  dplyr::select(scientificName, decimalLatitude, decimalLongitude, kingdom, phylum,
         family, genus, genericName, stateProvince, year, month, day,
         eventDate, class, country, occurrenceRemarks, habitat) %>% 
  mutate(habitat = capitalize(tolower(habitat))) %>% 
  filter(decimalLongitude > -78) ->
  data_to_clean
data_to_clean
```


```{r}
data_to_clean
```

# Marcadores {.tabset .tabset-fade .tabset-pills}

## Inicial

```{r, fig.width=9}
leaflet() %>% 
  addTiles()
```

## Añadir círculos (puntos)

```{r, fig.width=9}
leaflet() %>% 
  addTiles() %>% 
  addCircles(data = data_to_clean, lat = ~decimalLatitude, lng = ~decimalLongitude)
```

## Círculo - Marcador

```{r, fig.width=9}
leaflet() %>% 
  addTiles() %>% 
  addCircleMarkers(data = data_to_clean, lat = ~decimalLatitude, lng = ~decimalLongitude)
```


## Añadir marcadores

```{r, fig.width=9}
leaflet() %>% 
  addTiles() %>% 
  addAwesomeMarkers(data = data_to_clean, lat = ~decimalLatitude, lng = ~decimalLongitude)
```

# Editando Color y etiquetas {.tabset .tabset-fade .tabset-pills}

- Editando el color por año.
- Colores disponibles en [ColorBrewer](https://colorbrewer2.org/).
- Para cambiar el color es posible usar la función colorFactor() con los colores preestablecidos y las etiquetas o niveles (*domain*) a utilizar. En este caso es el mes de observación del oso.
- El argumento **label** permite controlar la leyenda correspondiente a cada punto cuando.

```{r, fig.width=9}
# Colores y nombres de etiqueta (leyenda)
colores <- c('#a6cee3', '#1f78b4', '#b2df8a', '#33a02c', '#fb9a99', '#e31a1c',
             '#fdbf6f', '#ff7f00', '#cab2d6', '#6a3d9a', '#ffff99', '#b15928')
meses <- levels(as.factor(data_to_clean$month))

# Cambiando color
paleta <- colorFactor(palette = colores, domain = meses)

leaflet() %>% 
  addTiles() %>% 
  addCircles(data = data_to_clean, lat = ~decimalLatitude, lng = ~decimalLongitude,
             color = ~paleta(month), fill = 1, label = ~occurrenceRemarks)
```

# Anexos